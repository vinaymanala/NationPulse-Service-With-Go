// Dashboard - Get Highest Population Of Countries

CREATE PROCEDURE get_highest_population_of_countries(current_year int, top_n_countries int)
LANGUAGE plpgsql
AS $$
BEGIN
SELECT * FROM perfgrowthpopulationds
WHERE
year = current_year
AND indicator_code LIKE 'POP'
ORDER BY value DESC LIMIT top_n_countries;
END;

$$
;


// Dashboard - Get Highest Health Related Cases Of Countries

CREATE PROCEDURE get_highest_health_cases_of_countries()
LANGUAGE plpgsql
AS
$$

BEGIN
SELECT DISTINCT ON (country_code) * FROM healthstatusds
WHERE
indicator_code LIKE 'CSEM'
AND sex_code LIKE '_T'
ORDER BY country_code, year DESC, value DESC;
END;

$$
;


// Dashboard - Get Highest GDP Per Capita Of Countries

CREATE PROCEDURE get_highest_gdp__of_countries(top_n_countries int)
LANGUAGE plpgsql
AS
$$

BEGIN
WITH ranked*data AS (
SELECT *, ROW_NUMBER() OVER (PARTITION BY country_code ORDER BY value DESC) as rn FROM gdppercapitads)
)
SELECT * FROM ranked_data
WHERE rn = 1
and year LIKE '2025-%'
ORDER BY value DESC LIMIT top_n_countries;
END;

$$
;


// Health - Get All Health Cases By Country

CREATE PROCEDURE get_health_cases_by_country(p_country_code character varying)
LANGUAGE plpgsql
AS
$$

BEGIN
SELECT * FROM healthstatusds
WHERE country_code LIKE country_code;
END;

$$
;


// Economy - Get Government Data By Country

CREATE PROCEDURE get_government_data_by_country(p_country_code character varying)
LANGUAGE plpgsql
AS
$$

BEGIN
SELECT * FROM publicgovernmentyearlyds
WHERE country_code LIKE p_country_code;
END;

$$
;


// Economy - Get GDP Per Capita By Country

CREATE PROCEDURE get_gdp_per_capita_by_country(p_country_code character varying)
AS
$$

BEGIN
SELECT * FROM gdppercapitads
WHERE country_code LIKE p_country_code;
END;

$$
;


// Population - Get Population By Country

CREATE PROCEDURE get_population_by_country(p_country_code character varying)
AS
$$

BEGIN
SELECT * FROM populationds
WHERE country_code LIKE p_country_code;
END;

$$
;


// Performance Growth - Get Performance Growth GDP By Country

CREATE PROCEDURE get_perf_growth_gdp_by_country(p_country_code character varying)
AS
$$

BEGIN
SELECT * FROM perfgrowthgdpds WHERE country_code LIKE p_country_code;
END;

$$
;


// Performance Growth - Get Performance Growth Working Population By Country

CREATE PROCEDURE get_perf_growth_working_population_by_country(p_country_code character varying)
AS
$$

BEGIN
SELECT * FROM perfgrowthpopulationds WHERE country_code LIKE p_country_code;
END;

$$
;


$$
